# TasqueManager

A Discord bot for the Kristal Discord server.

> [!WARNING]
> This is not meant for public use. The bot is specifically designed for the Kristal Discord server and may not function correctly in other servers.

---

## Commands

### Public commands

- `/ping` - Basic status check command to verify the bot is online.
- `/tag [name]` - Sends a predefined message associated with the given tag name. **Tags are static and can only be added or modified in the source.**

### Moderator commands

- `/timeout [user] [duration] [reason]` - Times out a user for the specified duration with an optional reason. The user will be notified via DM.

### Owner-only commands

- `/register` - Registers the bot's commands globally. The bot does not contain any guild-specific commands.

---

## Context Menu Commands

- `Timeout (User)` - Times out a user for a specified duration with an optional reason. The user will be notified via DM.
- `Timeout (Message)` - Times out the author of a specific message for a specified duration with an optional reason. The user will be notified via DM, and the offending message will be included in the notification.

---

## Tags

Tags are predefined messages that can be sent using the `/tag` command. They use **ComponentsV2** and therefore their source is entirely JSON files.

### Adding or modifying tags

We use [discord.builders](https://discord.builders) to create and edit tags.
Under the `tags` directory in the repository you will find every JSON file representing a tag. For example, the `how2ask` tag is stored in `tags/how2ask.json`. Additionally, you can nest tags in subdirectories. For example, `tags/rules/1.json` is a valid tag, and the ID would be `rules/1`.

We keep the "source" links generated by [discord.builders](https://discord.builders) in `tags/sources.txt` for easy access. To modify a tag, simply find its link in that file and open it in your browser, modify it, verify it works (by using the webhook test on the site), and then copy the resulting JSON back into the corresponding file. If you add a new tag, PLEASE add the URL to the `tags/sources.txt` file as well.

Sometimes a tag is modified AFTER being generated -- it should say why near the link in `tags/sources.txt` if so. Make sure to apply the same manual changes if you edit that tag.

### Adding attachments to tags

The bot will automatically upload any files in the `tags/<tag_name>/` directory. For example, `how2ask` uses two attachments, so the bot automatically attaches `tags/how2ask/error.txt` and `tags/how2ask/GSTR_04131225.png` when sending the tag's message.

To use the attachments anywhere in the message (instead of just the end), use Discord's special attachment URI scheme: `attachment://<filename>`. For example, the image in the `how2ask` tag is referenced in the JSON as `attachment://GSTR_04131225.png`.
On the website, you can manually enter the URL, so this is supported fine.

### Adding custom emotes

Ask someone in the Discord Developer "Kristal" Team to add bot emotes if you need them. If you're on the team, you can add them yourself by going to [the Discord Developer Portal](https://discord.com/developers/applications), scrolling to the **Kristal** team and selecting **Tasque Manager**, going to the **Emojis** tab, and uploading the emotes there. Ideally, we shouldn't need this very often, but formatting messages with custom emotes is very useful for presentation.

## Running the bot

The bot uses NodeJS. You will need to install all modules (`npm install`), and then create a `.env` file with the following variables:

```env
DISCORD_TOKEN="YOUR-BOT-TOKEN-HERE"
DISCORD_CLIENT_ID="YOUR-BOT-CLIENT-ID"
DISCORD_OWNER_ID="YOUR-USER-ACCOUNT-ID"
```

Please make sure to test the bot before submitting any changes. We recommend you do this by making a testing bot account.
